

<!--
 * @version:
 * @Author:  StevenJokess（蔡舒起） https://github.com/StevenJokess
 * @Date: 2023-03-18 02:23:14
 * @LastEditors:  StevenJokess（蔡舒起） https://github.com/StevenJokess
 * @LastEditTime: 2023-03-18 18:39:09
 * @Description:
 * @Help me: 如有帮助，请赞助，失业3年了。![支付宝收款码](https://github.com/StevenJokess/d2rl/blob/master/img/%E6%94%B6.jpg)
 * @TODO::
 * @Reference:
-->
# 玻尔兹曼分布

大多数人应该都是在利用神经网络解分类问题时第一次接触 softmax，对它的印象也只停留在把实数域的输出转换为合法的概率分布这里，本文介绍 softmax 的本源 —— 玻尔兹曼分布[2]

## Boltzmann分布

Boltzmann分布是一种常用的概率分布函数，Boltzmann分布描述了系统处于某一能量状态的概率与能量大小和温度的关系。

$$
P(E)=\frac{1}{Z} e^{-E/kT}
$$

其中，$E$ 表示系统的能量，$k$ 表示 玻尔兹曼常数 $k=1.38064852(79) \times 10^{-23} \mathrm{~J} / \mathrm{K}$，$β$ 表示温度的倒数，$Z$ 表示归一化常数，也称为配分函数，$\mathrm{Z}=\sum_k e^{-E_k / k_b T}$ 可以看出玻尔兹曼分布于softmax的形式基本上一模一样。

Boltzmann分布描述了系统处于某一能量状态的概率与能量大小和温度的关系。

```python

import numpy as np

def boltzmann_distribution(energies, temperature):
    """
    根据Boltzmann分布计算概率分布
    :param energies: 能量值的列表
    :param temperature: 温度参数
    :return: 概率分布的列表
    """
    exp_values = np.exp(-np.array(energies) / temperature)
    probabilities = exp_values / np.sum(exp_values)
    return probabilities
```

在基于Boltzmann分布的策略函数中，给定一个状态 $s$，动作 $a$的概率可以表示为：

$$
\pi(a \mid s)=\frac{\exp (Q(s, a) / T)}{\sum_{a^{\prime}} \exp \left(Q\left(s, a^{\prime}\right) / T\right)}
$$

基于Boltzmann分布的策略函数可以使得智能体在选择动作时具有一定的随机性，从而避免陷入局部最优解，提高算法的探索能力。此外，基于Boltzmann分布的策略函数也被广泛应用于模型生成和对抗训练等领域。


---

# 理解玻尔兹曼分布

波尔兹曼分布是热力学与统计物理中的一个重要分布，它建立起 “宏观温度” 和 “微观粒子能量” 间的关系。具体而言，考虑一组理想状态下的粒子，要求

1. 一个理想气体系统包含了巨大数量的以不同速度随机在各个方向上运动的全同气体分子
1. 与分子间距相比，分子直径大小可以忽略不计
1. 分子间除了相互间的完全弹性碰撞外别无其他相互作用
1. 单个分子的运动遵循经典力学定律
1. 在没有外势的情况下，当理想气体处在 ​*​平衡态*​​ 时气体分子均匀分布在系统中
1. 在 ​*​平衡态*​​，分子的速度在各方向上均匀分布，即理想气体的分子速度是随机的，并不存在一个特别偏好的方向

- 将满足上述状态的理想气体（或理想状态的一组粒子）加热到一定温度（向系统内输入能量），各个微观粒子会以一定的速度进行随机运动和碰撞，在禁止一切能量交换和损失的情况下，**各个粒子最终会稳定在一系列从低到高的不同能级上，即达到 ​*​平衡态​*​，此时系统的熵最大**

> 除了混乱程度外，熵也可以表示有多少种到达此状态的方法。系统总能量是一定的，一些粒子占有的能量高，其他粒子占有的就少
>
> 只有少量的方法能将能量只分配给少量粒子（而且由于碰撞作用这些能量也会很快被传递给其他粒子）
> 只有少量方法能让所有粒子能量一致（同样很快会由于碰撞导致能量转移，从而离开该状态）
> 因此最高熵时会呈现中等能级粒子多，高/低能级粒子少的状态，这就是 ​*​平衡态​​*

将**各个能级的粒子数除以系统种粒子总数就得到一个分布形式，平衡态时对应的就是** ​*​玻尔兹曼分布/吉布斯分布​​*​（热力学中称最概然分布），这个分布是会随着系统温度变化的，形如下图所示

注意几个点：

1. 理想气体几乎没有相互作用，那么它的能量（准确来说是哈密顿量）只有动能，因此可以用粒子速度表示，这里横轴是速度，其实是粒子能量
1. 曲线越红，系统温度越高，粒子能达到的越高能量越高，玻尔兹曼分布曲线拉得越平，越接近均匀分布，系统熵越大


[1]: https://chat.openai.com/chat
[2]: https://blog.51cto.com/u_15887260/5877064
